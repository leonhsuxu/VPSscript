# .github/workflows/Telegram_PublicLink.yml
name: ğŸŸ¢ Telegram èŠ‚ç‚¹æŠ“å–ä¸åˆå¹¶

on:
  schedule:
    - cron: '0 */4 * * *' # æ¯4å°æ—¶è¿è¡Œä¸€æ¬¡ (UTCæ—¶é—´)
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘å·¥ä½œæµ

jobs:
  scrape_and_process:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.x'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        # ä¿®æ­£ 1ï¼šåŒæ—¶å®‰è£… telethon å’Œ pyyaml
        pip install telethon pyyaml

    - name: Run Python script
      env:
        #
        # === åœ¨æ­¤å¤„ä¿®æ”¹è¦æŠ“å–çš„ Telegram é¢‘é“/ç¾¤ç»„ ID åˆ—è¡¨ ===
        #
        TELEGRAM_CHANNEL_IDS: |
          @fqDINYUE
          # @channel2
          # -1001234567890
        #
        # === å‡­æ®ï¼ˆä» GitHub Secrets è·å–ï¼‰===
        #
        TELEGRAM_API_ID: ${{ secrets.TELEGRAM_API_ID }}
        TELEGRAM_API_HASH: ${{ secrets.TELEGRAM_API_HASH }}
        TELEGRAM_STRING_SESSION: ${{ secrets.TELEGRAM_STRING_SESSION }}
      run: |
        # ç¡®è®¤è„šæœ¬è·¯å¾„æ­£ç¡®
        python TelegramNode/telegram_publiclink.py

    - name: Commit and push changes
      uses: stefanzweifel/git-auto-commit-action@v5
      with:
        commit_message: "è‡ªåŠ¨æ›´æ–°ï¼šåˆå¹¶ Telegram èŠ‚ç‚¹"
        # ä¿®æ­£ 2ï¼šåŒ¹é… Python è„šæœ¬çš„å®é™…è¾“å‡ºæ–‡ä»¶å
        file_pattern: "flclashyaml/telegram_scraper.yaml"
