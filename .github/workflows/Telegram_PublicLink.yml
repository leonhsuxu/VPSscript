# .github/workflows/Telegram_PublicLink.yml
name: ♻️ Telegram 节点抓取与合并

on:
  schedule:
    - cron: '10 */2 * * *'  # 每2小时执行
  workflow_dispatch: # 允许手动触发工作流

jobs:
  scrape_and_process:
    runs-on: ubuntu-latest
    steps:
    - name: 检出代码仓库
      uses: actions/checkout@v4
    - name: 拉取并变基
      run: git pull --rebase
    - name: 设置 Python 环境
      uses: actions/setup-python@v5
      with:
        python-version: '3.x'
    - name: 安装依赖
      run: |
        python -m pip install --upgrade pip
        pip install telethon pyyaml requests  # 添加 requests 的安装步骤
    - name: 运行 Python 脚本
      env:
        TELEGRAM_CHANNEL_IDS: |
         # 订阅转发-频道
         @fqDINYUE          
         # 白嫖订阅&节点分享群
         @freeyule          
         # CC宝盒
         @ccbaohe           
         # Duang VPS交流群
         @duangvpsfs        
         # 虚空新手村
         @XuKong11          
         # 白嫖机场交流群   
         @zzzjjjkkkoi       
         # M麦当劳 全家桶
         @xmdexw            
         # v2clash 免费分享中心
         @v2v2clash         
         # 订阅分享中心
         @dingyue_Center  
         
        TELEGRAM_API_ID: ${{ secrets.TELEGRAM_API_ID }}
        TELEGRAM_API_HASH: ${{ secrets.TELEGRAM_API_HASH }}
        TELEGRAM_STRING_SESSION: ${{ secrets.TELEGRAM_STRING_SESSION }}
      run: |
        python TelegramNode/telegram_publiclink.py
    - name: 提交并推送更改
      uses: stefanzweifel/git-auto-commit-action@v5
      with:
        commit_message: "自动更新：合并 Telegram 节点"
        file_pattern: "flclashyaml/telegram_scraper.yaml"
