# .github/workflows/Telegram_PublicLink.yml
name: ♻️ Telegram 节点抓取与合并

on:
  schedule:
    - cron: '10 16,20,0,4,8,12 * * *'  # 北京时间: 0:10, 4:10, 8:10, 12:10, 16:10, 20:10
  workflow_dispatch: # 允许手动触发工作流

jobs:
  scrape_and_process:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    #
    # --- 新增的修正步骤 ---
    # 在执行任何操作之前，先拉取远程分支的最新更改并变基。
    # 这会同步本地工作区，从而避免 "non-fast-forward" 错误。
    #
    - name: Pull and Rebase
      run: git pull --rebase

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.x'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install telethon pyyaml

    - name: Run Python script
      env:
        TELEGRAM_CHANNEL_IDS: |
          # 订阅转发-频道
          @fqDINYUE
          
          # 白嫖订阅&节点分享群
          @freeyule
          
          # CC宝盒
          @ccbaohe
          
          # Duang VPS交流群
          @duangvpsfs
          
          # 虚空新手村
          @XuKong11
          
          # 白嫖机场交流群
          @zzzjjjkkkoi
          
          # M麦当劳 全家桶
          @xmdexw
          
          # v2clash 免费分享中心
          @v2v2clash
          
          # 订阅分享中心
          @dingyue_Center


          # 在此添加更多频道...
        TELEGRAM_API_ID: ${{ secrets.TELEGRAM_API_ID }}
        TELEGRAM_API_HASH: ${{ secrets.TELEGRAM_API_HASH }}
        TELEGRAM_STRING_SESSION: ${{ secrets.TELEGRAM_STRING_SESSION }}
      run: |
        python TelegramNode/telegram_publiclink.py

    - name: Commit and push changes
      uses: stefanzweifel/git-auto-commit-action@v5
      with:
        commit_message: "自动更新：合并 Telegram 节点"
        file_pattern: "flclashyaml/telegram_scraper.yaml"
