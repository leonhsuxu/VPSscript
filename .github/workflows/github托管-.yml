name: ğŸ—ƒï¸ Github.èŠ‚ç‚¹æ›´æ–°
on:
  schedule:
    # æ¯å¤© UTC 0:00 (åŒ—äº¬æ—¶é—´ 8:00) è‡ªåŠ¨è¿è¡Œ
    - cron: '0 0 * * *'
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘
  push:
    branches:
      - main
    # æ³¨æ„ï¼šè¿™é‡Œçš„è·¯å¾„æ— æ³•ä½¿ç”¨å˜é‡ï¼Œå¦‚æœä¿®æ”¹äº†è„šæœ¬è·¯å¾„ï¼Œéœ€è¦æ‰‹åŠ¨åŒæ­¥ä¿®æ”¹æ­¤å¤„
    paths:
      - 'flclashyaml/Github-SSRProxy.py'
permissions:
  contents: write
jobs:
  update:
    runs-on: ubuntu-latest
    env:
      # --- æ‚¨å¯ä»¥åœ¨è¿™é‡Œé›†ä¸­ä¿®æ”¹æ‰€æœ‰å˜é‡ ---
      CLASH_OUTPUT_FILENAME: Github-SSRProxy.yaml         # <-- è¾“å‡ºçš„é…ç½®æ–‡ä»¶å
      PYTHON_SCRIPT_PATH: flclashyaml/Github-SSRProxy.py  # <-- è¦æ‰§è¡Œçš„ Python è„šæœ¬è·¯å¾„
      COMMIT_MESSAGE_PREFIX: "ğŸ—ƒï¸ Github.èŠ‚ç‚¹æ›´æ–°"           # <-- Git æäº¤ä¿¡æ¯çš„å‰ç¼€

    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
    - name: è®¾ç½® Python 3.11
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    - name: å®‰è£…ä¾èµ–
      run: |
        python -m pip install --upgrade pip
        pip install requests pyyaml
    - name: è¿è¡Œåˆå¹¶ä¸é‡å‘½åè„šæœ¬
      run: |
        # è„šæœ¬å°†é€šè¿‡ CLASH_OUTPUT_FILENAME çŸ¥é“è¦è¾“å‡ºçš„æ–‡ä»¶å
        # é€šè¿‡ PYTHON_SCRIPT_PATH å¼•ç”¨è¦æ‰§è¡Œçš„è„šæœ¬
        python ${{ env.PYTHON_SCRIPT_PATH }}
    - name: æäº¤æ›´æ–°åˆ°ä»“åº“
      run: |
        git config --local user.email "41898282+github-actions[bot]@users.noreply.github.com"
        git config --local user.name "github-actions[bot]"
        # ä½¿ç”¨å˜é‡æ¥æ·»åŠ æ–‡ä»¶
        git add flclashyaml/${{ env.CLASH_OUTPUT_FILENAME }}
        if ! git diff --staged --quiet; then
          # ä½¿ç”¨å˜é‡ä½œä¸ºæäº¤ä¿¡æ¯çš„å‰ç¼€
          git commit -m "${{ env.COMMIT_MESSAGE_PREFIX }} $(date -u +'%Y-%m-%d %H:%M:%S UTC')"
          git push
        else
          echo "æ–‡ä»¶æ— å˜åŒ–ï¼Œæ— éœ€æäº¤ã€‚"
        fi
