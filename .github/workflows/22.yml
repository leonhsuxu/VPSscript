name: Fetch and Commit Pastecode Content

on:
  push:
    branches: [ main ]
  workflow_dispatch:
  schedule:
    - cron: '0 0 * * *'

jobs:
  fetch-and-commit:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
      
      - name: Fetch content from pastecode
        run: |
          echo "æ­£åœ¨è·å–æ•°æ®..."
          curl "https://pastecode.dev/raw/hntbocnp/%E5%81%A5%E5%BA%B7%E4%B8%AD%E5%BF%83618ord" -o data.yaml
          
          if [ -f data.yaml ]; then
            echo "âœ“ æ•°æ®è·å–æˆåŠŸ"
            echo "æ–‡ä»¶å¤§å°: $(wc -c < data.yaml) bytes"
            echo "è¡Œæ•°: $(wc -l < data.yaml) lines"
          else
            echo "âœ— æ•°æ®è·å–å¤±è´¥"
            exit 1
          fi
      
      - name: Commit and push changes
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add data.yaml
          git commit -m "ğŸ”„ æ›´æ–°æ•°æ® - $(date +'%Y-%m-%d %H:%M:%S')" || echo "æ— éœ€æäº¤"
          git push || echo "æ— éœ€æ¨é€"
          echo "âœ“ æ•°æ®å·²æ›´æ–°"
      
      - name: Summary
        run: |
          echo "### æ‰§è¡Œæ‘˜è¦ ğŸ“Š" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "- æ‰§è¡Œæ—¶é—´: $(date +'%Y-%m-%d %H:%M:%S')" >> $GITHUB_STEP_SUMMARY
          echo "- æ•°æ®æº: pastecode.dev" >> $GITHUB_STEP_SUMMARY
          echo "- è¾“å‡ºæ–‡ä»¶: data.yaml" >> $GITHUB_STEP_SUMMARY
          if [ -f data.yaml ]; then
            echo "- æ–‡ä»¶å¤§å°: $(wc -c < data.yaml) bytes" >> $GITHUB_STEP_SUMMARY
          fi
